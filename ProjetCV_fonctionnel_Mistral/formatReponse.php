<?php

$response_format = [
    "type" => "json_schema",
    "json_schema" => [
        "schema" => [
            "title" => "CV",
            "type" => "object",
            "properties" => [
                "nom" => [
                    "description" => "Remplis ce champ uniquement si une information textuelle explicite permet d'identifier clairement un pr√©nom et un nom (ex. : une ligne isol√©e en haut du CV contenant deux mots). √âcrit le nom et le pr√©nom dans cette ordre. Il doit toujours y avoir au minimum deux mots pour remplir ce champ. Ne te base pas uniquement sur la taille de police ou la mise en forme pour deviner le nom si aucune mention claire n'est pr√©sente.",
                    "type" => "string"
                ],
                "age" => [
                    "description" => " L'√¢ge est g√©n√©ralement indiqu√© par un nombre suivi de termes comme '√¢ge :', 'ans', ou 'ann√©es'. Concentre-toi sur les sections o√π des informations personnelles sont mentionn√©es, comme les sections 'Contact', 'Profil', ou 'Informations personnelles'. Si l'√¢ge est explicitement √©crit, utilise cette valeur sans faire de calculs suppl√©mentaires et assure-toi qu'il s'agit bien de l'√¢ge actuel. Assure-toi de v√©rifier que le nombre est bien associ√© √† l'√¢ge et non √† d'autres informations comme une date ou une ann√©e. Si plusieurs mentions d'√¢ge sont pr√©sentes, utilise celle qui est la plus clairement associ√©e √† l'√¢ge actuel de la personne. Si tu ne trouve pas l'√¢ge de la personne mais uniquement la date ou l'ann√©e de naissance, alors calcul l'√¢ge de la personne en utilisant la date du jour fourni. Ne fais pas de suppositions et ne cr√©e pas d'informations ; utilise uniquement les donn√©es exactes fournies dans le CV.",
                    "type" => "integer"
                ],
                "situation_familiale" => [
                    "enum" => ["mari√©", "mari√©e", "c√©libataire", "divorc√©", "en couple", "pacs√©", "veuf", "veuve"],
                    "description" => "doit √™tre rempli uniquement si l‚Äôun des termes suivants appara√Æt : ¬´ mari√© ¬ª, ¬´ mari√©e ¬ª, ¬´ c√©libataire ¬ª, ¬´ divorc√© ¬ª, ¬´ en couple ¬ª, ¬´ pacs√© ¬ª.",
                    "type" => "string"
                ],
                "nationalite" => [
                    "description" => "Identifi la nationalit√©. Attention, verifie bien qu'il s'agit de la nationalit√© et pas d'une langue parl√©e, ni avec le pays o√π vie la personne. ",
                    "type" => "string"
                ],
                "contact" => [
                    "description" => "Coordonn√©es personnelles extraites du document. Ne jamais inventer ni compl√©ter ces donn√©es si elles ne sont pas clairement pr√©sentes. Si elle n'est pas clairement identifiable, ne rempli pas ce champ.",
                    "type" => "object",
                    "properties" => [
                        "email" => [
                            "pattern" => "^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}$",
                            "description" => "D√©tecter les adresses email explicites, m√™me si non accompagn√©es du mot 'email' : s‚Äôaider des symboles comme '@', enveloppe, ou ic√¥ne de courriel. Ne prendre en compte que les formats corrects (ex. texte@domaine.ext). Fais attention √† ne pas te tromper dans les chiffres potentiellement pr√©sents, fais attention √† la police de caract√®re pour ne pas m√©langer un chiffre avec un autre. Si tu ne vois pas de mail, ne le cr√©er pas.",
                            "type" => "string"
                        ],
                        "telephone" => [
                            "pattern" => "^(\\+\\d{1,3}[ .-]?)?(\\(?\\d{1,4}\\)?[ .-]?){2,5}\\d{2,4}$",
                            "description" => "Num√©ro de t√©l√©phone reconnaissable par sa forme ou la pr√©sence de symboles (ex. t√©l√©phone, combin√©, üìû, +33), m√™me sans mot explicite. Extraire les suites de 10 √† 14 chiffres, les normaliser au format international. Le num√©ro peut √™tre √©crit de diff√©rentes fa√ßons : sans espaces, avec des tirets entre plusieurs chiffres ou nombres, des points, ou des parenth√®ses. Si tu ne vois pas de num√©ro de t√©l√©phone, ne le cr√©e pas",
                            "type" => "string",
                        ],
                        "adresse" => [
                            "description" => "Adresse postale compl√®te si pr√©sente explicitement.",
                            "type" => "object",
                            "properties" => [
                                "rue" => [
                                    "description" => "Num√©ro et nom de rue.",
                                    "type" => "string"
                                ],
                                "complement" => [
                                    "description" => "Information compl√©mentaire (√©tage, b√¢timent) si indiqu√©e.",
                                    "type" => "string"
                                ],
                                "ville" => [
                                    "description" => "Ville.",
                                    "type" => "string"
                                ],
                                "code_postal" => [
                                    "pattern" => "^[0-9]{5}$",
                                    "description" => "Code postal (5 chiffres).",
                                    "type" => "string"
                                ],
                                "region" => [
                                    "description" => "R√©gion, d√©partement ou province si mentionn√©.",
                                    "type" => "string"
                                ],
                                "pays" => [
                                    "description" => "Pays.",
                                    "type" => "string"
                                ]
                            ],
                            "additionalProperties" => false
                        ],
                        "permis" => [
                            "enum" => ["Permis A", "Permis B", "Permis C", "Permis D", "Permis E", "permis de conduire", "titulaire du permis", "j‚Äôai mon permis"],
                            "description" => "indique uniquement si le texte mentionne explicitement la possession d‚Äôun permis de conduire. Cela inclut toutes les formulations comme : ¬´ permis B ¬ª, ¬´ je poss√®de le permis ¬ª, ¬´ titulaire du permis ¬ª, ¬´ permis de conduire ¬ª, ¬´ j‚Äôai mon permis ¬ª, ¬´ permis en poche ¬ª, ¬´ permis obtenu ¬ª, ¬´ conduite accompagn√©e termin√©e ¬ª, etc. Si rien n‚Äôindique clairement que la personne a le permis, ne renseigne pas ce champ..",
                            "type" => "string"
                        ],
                        "vehicule" => [
                            "enum" => ["Oui", "Non"],
                            "description" => "Le champ vehicule ne doit √™tre rempli par oui uniquement si une mention explicite est pr√©sente dans le texte (ex. : 'je poss√®de un v√©hicule', 'voiture personnelle', 'v√©hicul√©(e)'). Si aucune information directe n‚Äôest fournie, laisse ce champ vide ou ne le renseigne pas..",
                            "type" => "string"
                        ]
                    ],
                    "required" => ["email", "telephone"],
                    "additionalProperties" => false
                ],
                "situation_professionnelle" => [
                    "description" => "Informations sur le statut et les disponibilit√©s professionnelles.",
                    "type" => "object",
                    "properties" => [
                        "statut" => [
                            "enum" => [
                                "√† la recherche d'emploi",
                                "salari√©",
                                "ind√©pendant",
                                "auto-entrepreneur",
                                "√©tudiant",
                                "en reconversion",
                                "demandeur d‚Äôemploi",
                                "en contrat d‚Äôapprentissage",
                                "en stage",
                                "retrait√©"
                            ],
                            "description" => "Valeur parmi celles list√©es, uniquement si mention explicite.",
                            "type" => "string"
                        ],
                        "poste_actuelle" => [
                            "description" => "identifie le poste actuel de la personne en utilisant des indicateurs tels que : 'maintenant', 'actuellement', '√† ce jour', 'en poste', 'en fonction', ou toute autre mention indiquant une activit√© professionnelle en cours. Fait attention de ne pas prendre le dernier poste effectu√© comme poste actuel, tu peux le savoir si il y a une date ou avec un indicateur comme ceux indiqu√©s pr√©c√©dement. Si l‚Äôinformation n‚Äôappara√Æt pas clairement ou aucune information claire n‚Äôest pr√©sente, laisse ce champ vide.'.",
                            "type" => "string",
                        ],
                        "poste_recherche" => [
                            "description" => "Extrait le poste recherch√© si mentionn√© clairement dans le document. Le poste peut appara√Ætre dans une phrase mais aussi de fa√ßon isol√© en plus gros sur la page. Il peut y avoir plusieurs phrases de ce type, alors sois prudent pour ne pas en oublier. Attention, si la phrase est d√©j√† inscrite autre part, ne recopie pas la phase une seconde fois. En cas de phrase commen√ßant par 'Je suis √† la recherche d'un emploi', 'Je recherche un emploi', '√† la recherche d'un emploi', 'Je suis √† la recherche d'un stage', 'Je recherche un stage', '√† la recherche d'un stage',... sers-toi en comme rep√®re. Ne m√©lange pas les exp√©riences professionnelles avec le poste recherch√©, ne prends pas la derni√®re exp√©rience professionnelle effectu√©e pour remplir ce champ. Si l'√©l√©ment est absent, ne rien renseigner dans ce champ.",
                            "type" => "string"
                        ],
                        "annees_experiences" => [
                            "pattern" => "^[0-9]+\\s+ans$",
                            "description" => "Ann√©es d‚Äôexp√©rience au format 'X ans' si explicitement indiqu√©.",
                            "type" => "string"
                        ],
                        "type_contrat_souhaite" => [
                            "description" => "Type de contrat souhait√© ou mentionn√© (CDI, CDD, int√©rim, apprentissage, stage, etc.).",
                            "type" => "string"
                        ],
                        "disponibilites" => [
                            "description" => "P√©riode de disponibilit√© en dates.",
                            "type" => "object",
                            "properties" => [
                                "date_debut" => [
                                    "description" => "Date de d√©but de disponibilit√©, elle est souvent √©crite assez proche du poste de recherche. Tous les formats de dates sont acc√®pt√©es, m√™me si elle n'est pas compl√®te.",
                                    "type" => "string",
                                ],
                                "date_fin" => [
                                    "description" => "Date de fin de disponibilit√©, elle est souvent √©crite assez proche du poste de recherche. Tous les formats de dates sont acc√®pt√©es, m√™me si elle n'est pas compl√®te.",
                                    "type" => "string"
                                ]
                            ],
                            "additionalProperties" => false
                        ]
                    ],
                    "additionalProperties" => false
                ],
                "competences" => [
                    "description" => "Liste des comp√©tences class√©es par cat√©gorie. Une comp√©tence ne doit jamais appara√Ætre dans plusieurs cat√©gories : choisis la plus repr√©sentative. Si des qualit√©s personnelles ne rentrent dans aucune autre cat√©gorie, inclue-les dans le champ qualites. N'h√©site pas √† r√©cup√©rer les descriptions des comp√©tences si elles sont not√©es.",
                    "type" => "object",
                    "properties" => [
                        "techniques" => [
                            "description" => "Comp√©tences m√©tiers techniques (ex. √©pilation, soins du corps, massage). √âcrit bien toutes les comp√©tances qui sont not√©es sur le CV, ne te limite pas √† la cat√©gorie 'Comp√©tence' du CV, cherche aussi dans les comp√©tences donn√©es dans la partie 'experiences professionnelles' par exemple. N'h√©site pas √† r√©cup√©rer les descriptions des comp√©tences si elles sont not√©es.",
                            "type" => "array",
                            "items" => ["type" => "string"],
                        ],
                        "logiciels_outils" => [
                            "description" => "Noms de logiciels, applications ou outils num√©riques explicitement mentionn√©s (ex. Excel, Word, CRM). Inclut aussi les r√©seaux sociaux, que les noms des r√©seaux soit √©crit ou pas. N'h√©site pas √† r√©cup√©rer les descriptions des comp√©tences si elles sont not√©es.",
                            "type" => "array",
                            "items" => ["type" => "string"],
                        ],
                        "methodologies" => [
                            "description" => "M√©thodes de travail ou normes (ex. HACCP, m√©thode Agile). N'h√©site pas √† r√©cup√©rer les descriptions des comp√©tences si elles sont not√©es.",
                            "type" => "array",
                            "items" => ["type" => "string"],
                        ]
                    ],
                    "additionalProperties" => false
                ],
                "aptitudes_professionnelles" => [
                    "description" => "Qualit√©s organisationnelles, relationnelles et autres.",
                    "type" => "object",
                    "properties" => [
                        "organisationnelles" => [
                            "description" => "Qualit√©s organisationnelles (rigueur, autonomie, gestion du temps).",
                            "type" => "array",
                            "items" => ["type" => "string"],
                        ],
                        "relationnelles" => [
                            "description" => "Qualit√©s relationnelles (communication, travail d‚Äô√©quipe).",
                            "type" => "array",
                            "items" => ["type" => "string"]
                        ],
                        "autres" => [
                            "description" => "Autres qualit√©s personnelles (curieuse, rigoureuse, d√©vou√©e), si elles n‚Äôentrent pas dans une autre cat√©gorie.",
                            "type" => "array",
                            "items" => ["type" => "string"]
                        ]
                    ],
                    "additionalProperties" => false
                ],
                "motivation" => [
                    "description" => "Identifie et extrais tous les mots, les groupe de mots et les phrases exprimant explicitement l‚Äôint√©r√™t pour le m√©tier, les objectifs professionnels, des slogans, des phrases de d√©vouement pour son travail et les formules de politesse. Recopie bien toute la/les phrases pr√©sente(s) et pas qu'une partie. Rassemble ces phrases dans un tableau ¬´ motivation ¬ª du JSON, sans doublons et sans inventer ou compl√©ter ce qui n‚Äôest pas explicitement pr√©sent. Ne prends pas pour les motivations les centres d'int√©r√™t/loisir, les qualit√©s et aptitudes professionnelles.",
                    "type" => "array",
                    "items" => ["type" => "string"]
                ],
                "experiences" => [
                    "description" => "Liste des exp√©riences professionnelles avec dates et d√©tails. Reste bien dans le cadre des experiences professionnelles, n'ajoute pas un poste en dehors de ce cadre. Met bien les experiences professionnelles dans l'ordre chronologique.",
                    "type" => "array",
                    "items" => [
                        "type" => "object",
                        "properties" => [
                            "poste" => [
                                "description" => "Intitul√© du poste.  ",
                                "type" => "string",
                            ],
                            "entreprise" => [
                                "description" => "Nom de l‚Äôentreprise.",
                                "type" => "string",
                            ],
                            "date_debut" => [
                                "description" => "Date de d√©but (m√™me si plac√©e au-dessus ou √©loign√©e du titre). La date doit toujours appara√Ætre sous le format suivant : jj/mm/ann√©e, si le jour n'est pas sp√©cifi√©, la date doit √™tre √©crite dans ce format : mm/ann√©e. Si seulement l'ann√©e appara√Æt √©crit uniquement l'ann√©e. Dans le cas o√π le jour n'est pas sp√©cifi√© ne prend pas le premier jour du mois comme jour.",
                                "type" => "string",
                            ],
                            "date_fin" => [
                                "description" => "Date de fin (m√™me si plac√©e au-dessus ou √©loign√©e du titre). La date doit toujours appara√Ætre sous le format suivant : jj/mm/ann√©e, si le jour n'est pas sp√©cifi√©, la date doit √™tre √©crite dans ce format : mm/ann√©e. Si seulement l'ann√©e appara√Æt √©crit uniquement l'ann√©e. Il peut ne pas y avoir de date, mais un ou des mot(s) permettant d'identifier si le poste est toujours d'actualit√© (maintenant, actuellement, en cours,...), si c'est le cas √©crit ce(s) mot(s). Dans le cas o√π le jour n'est pas sp√©cifi√© ne prend pas le premier jour du mois comme jour.",
                                "type" => "string",
                            ],
                            "duree" => [
                                "description" => "Si il y a une dur√©e contnant 'depuis ..., employ√© depuis ..., etc' ou nimporte qu'elle autre expression qui sous-entends que l'emploi est toujours actuel, alors √©crit-le. S'il n'y en a pas, n'√©crit rien dans ce champ.",
                                "type" => "string",
                            ],
                            "lieu_d'activite" => [
                                "description" => "Lieu g√©ographique de l‚Äôactivit√©.",
                                "type" => "string",
                            ],
                            "type_contrat" => [
                                "enum" => ["CDI", "CDD", "stage", "int√©rim", "apprentissage", "alternant"],
                                "description" => "Identifie  les types de contrats (CDI, CDD, int√©rim, stage, etc,...), ils peuvent √™tre √† c√¥t√© de la dur√©e, du nom de l'entreprise, de l'ann√©e d'exercice, des activit√©es ou dans le nom de l'exp√©rience. D√®s qu'il y a un nom de contrat donn√© inscrit-le dans le champ.",
                                "type" => "string"
                            ],
                            "activites_descriptions" => [
                                "description" => "Listes et descriptions des t√¢ches ou activit√©s r√©alis√©es. Ce champ doit √™tre remplit avec toutes les informations compl√©mentaires sur le poste,  c'est-√†-dire les actions r√©alis√©es, les comp√©tences travaill√©es, etc... Si l'information n'est pas pr√©sente dans le CV, alors n'affiche pas ce champ.",
                                "type" => "array",
                                "items" => ["type" => "string"]
                            ]
                        ],
                        "additionalProperties" => false
                    ]
                ],
                "formations" => [
                    "description" => "Liste des formations avec dates, √©tablissements et mentions.",
                    "type" => "array",
                    "items" => [
                        "type" => "object",
                        "properties" => [
                            "intitule" => [
                                "description" => "Intitul√© de la formation.",
                                "type" => "string",
                            ],
                            "etablissement" => [
                                "description" => "Nom de l‚Äô√©tablissement.",
                                "type" => "string",
                            ],
                            "date_debut" => [
                                "description" => "Date de d√©but (m√™me si plac√©e au-dessus ou √©loign√©e du titre). La date doit toujours appara√Ætre sous le format suivant : jj/mm/ann√©e, si le jour n'est pas sp√©cifi√©, la date doit √™tre √©crite dans ce format : mm/ann√©e. Si seulement l'ann√©e appara√Æt √©crit uniquement l'ann√©e. Dans le cas o√π le jour n'est pas sp√©cifi√© ne prend pas le premier jour du mois comme jour.",
                                "type" => "string",
                            ],
                            "date_fin" => [
                                "description" => "Date de fin (m√™me si plac√©e au-dessus ou √©loign√©e du titre). La date doit toujours appara√Ætre sous le format suivant : jj/mm/ann√©e, si le jour n'est pas sp√©cifi√©, la date doit √™tre √©crite dans ce format : mm/ann√©e. Si seulement l'ann√©e appara√Æt √©crit uniquement l'ann√©e. Il peut ne pas y avoir de date, mais un ou des mot(s) permettant d'identifier si le poste est toujours d'actualit√© (maintenant, actuellement, en cours,...), si c'est le cas √©crit ce(s) mot(s). Dans le cas o√π le jour n'est pas sp√©cifi√© ne prend pas le premier jour du mois comme jour.",
                                "type" => "string",
                            ],
                            "duree" => [
                                "description" => "Si il y a une dur√©e contnant 'depuis ..., employ√© depuis ..., etc' ou nimporte qu'elle autre expression qui sous-entends que l'emploi est toujours actuel, alors √©crit-le. S'il n'y en a pas, n'√©crit rien dans ce champ.",
                                "type" => "string",
                            ],
                            "option" => [
                                "description" => "Option ou sp√©cialit√© si mentionn√©e.",
                                "type" => "string",
                            ],
                            "specialites" => [
                                "description" => "Sp√©cialit√©s list√©es dans la formation.",
                                "type" => "array",
                                "items" => ["type" => "string"],
                            ],
                            "mention" => [
                                "description" => "Mention du dipl√¥me, uniquement l‚Äôun des libell√©s list√©s.",
                                "type" => "string",
                                "enum" => ["assez bien", "bien", "tr√®s bien", "f√©licitations du jury"],
                            ]
                        ],
                        "additionalProperties" => false
                    ]
                ],
                "langues" => [
                    "description" => "Liste des langues avec niveaux original et normalis√©.",
                    "type" => "array",
                    "items" => [
                        "type" => "object",
                        "properties" => [
                            "langue" => [
                                "description" => "Nom de la langue.",
                                "type" => "string",
                            ],
                            "niveau_original" => [
                                "description" => "Niveau tel qu‚Äô√©crit dans le CV (ex : bilingue, A2, 4/5). Le niveau doit obligatoirement √™tre √©crit avec des lettres, chiffres ou mots. Si aucun texte n‚Äôest √©crit, ne renseigne pas ce champ. Ignore tout niveau exprim√© uniquement par des symboles (ex : ‚úÖ, ‚óè, ‚òë). Ne remplis le champ niveau_original que s‚Äôil contient au moins une lettre ou un chiffre. N'invente pas le niveau si tu n'es pas s√ªr. ",
                                "pattern" => "[a-zA-Z0-9]",
                                "type" => "string"
                            ],

                            "niveau_normalise" => [
                                "type" => "integer",
                                "minimum" => 1,
                                "maximum" => 5,
                                "description" => "Niveau converti en entier (1=faible, 5=excellent). Essaye s'interp√©ter avec le r√©sultat du niveau original pour trouver la note la plus proche du niveau annonc√©."
                            ]
                        ],
                        "required" => ["langue"],
                        "additionalProperties" => false
                    ]
                ],
                "centres_interet" => [
                    "description" => "Analyse l'image ou le texte pour identifier les centres d'int√©r√™t. Recherche des illustrations, ic√¥nes ou mots indiquant des hobbies ou passions. Cat√©gorise-les en groupes comme sports, arts ou cuisine. D√©cris bri√®vement chaque centre d'int√©r√™t trouv√©. Base-toi uniquement sur les informations visibles ou mentionn√©es. Pr√©sente les r√©sultats sous forme de liste. R√©cup√®re les informations uniquement si elle se trouve dans un champ 'loisir', 'centres d'int√©r√™ts', 'passion' ou 'activit√©', veille bien √† ce que le champ soit pr√©c√©d√© de l'uns de ces mots. Si le nom est 'autre', v√©rifie bien qu'il s'agit de centre d'int√©r√™t avant de recopier.",
                    "type" => "array",
                    "items" => ["type" => "string"],
                ]
            ],
            "additionalProperties" => false
        ],
        "name" => "cv",
        "strict" => true
    ]
];
